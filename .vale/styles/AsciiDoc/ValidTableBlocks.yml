---
extends: script
ignorecase: true
level: error
message: "Check that table has a closing table code block TEST."
link: https://docs.asciidoctor.org/asciidoc/latest/directives/ifdef-ifndef/
scope: raw
script: |
  text := import("text")
  
  matches := []

  tbl_delimiter_regex := "\\|==="
  counter := 0
  for line in text.split(scope, "\n") {
    if text.re_match(tbl_delimiter_regex, line) {
      counter ++
      start := text.index(scope, line)
      matches = append(matches, {begin: start, end: start + len(line)})
      fmt.println("Delimiter matches: ",len(matches))
      fmt.println(line)
    }
  }
  fmt.println(counter)
  fmt.println(counter % 2)
  if counter % 2 == 1{
    fmt.println("We got an odd number of delimiters here")
    } else{
      fmt.println("Delimiters lookin good")
      }

  if len(matches) == 0 {
    fmt.println(matches)
    } else{
      fmt.println(matches)
      }