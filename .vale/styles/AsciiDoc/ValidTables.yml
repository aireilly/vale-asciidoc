---
extends: script
ignorecase: true
level: error
message: "AsciiDoc file contains an invalid table."
link: https://docs.asciidoctor.org/asciidoc/latest/tables/build-a-basic-table/
scope: raw
script: |
  text := import("text")

  matches := []
  tbl_delim_regex := "\\|={3,4}"
  table_attrs_regex := "\\[(frame.*|cols.*|options.*|\\..*|%.*)\\]"
  table_attrs := 0

  for line in text.split(scope, "\n") {
    if text.re_match(table_attrs_regex, line){
      table_attrs += 1
    } else if text.re_match(tbl_delim_regex, line){
      start := text.index(scope, line)
      matches = append(matches, {begin: start, end: start + len(line)})  
    }
  }

  if len(matches)/2 == table_attrs {
    matches = []
  }
