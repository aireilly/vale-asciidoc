---
extends: script
ignorecase: true
level: error
message: "Do not include xrefs in modules, only assemblies."
link: https://github.com/openshift/openshift-docs/blob/main/contributing_to_docs/doc_guidelines.adoc#links-hyperlinks-and-cross-references
scope: raw
script: |
  text := import("text")

  matches := []
  xref_regex := "xref:(.*)(\\.adoc)#(.*)"
  content_type_regex := "^:_content-type:\\s(CONCEPT|PROCEDURE|REFERENCE)"
  module := false

  //if the file has a module content-type, flag the xref error
  for line in text.split(scope, "\n") {
    if text.re_match(content_type_regex, line) {
      module = true
  } else if text.re_match(xref_regex, line) && module == true {
      start := text.index(scope, line)
      matches = append(matches, {begin: start, end: start + len(line)})
    }
  }